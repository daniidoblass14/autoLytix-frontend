<app-header></app-header>

<ion-content [fullscreen]="true" class="vehicles-content">
  <!-- MODO MÓVIL: Contenedor móvil -->
  <div class="content-wrapper mobile-wrapper">
    <!-- Título y Subtítulo -->
    <div class="page-header">
      <h1 class="page-title">Mis Vehículos</h1>
      <p class="page-subtitle">Administra y monitorea tus autos</p>
    </div>

    <!-- Botón Agregar Vehículo (MÓVIL: full width) -->
    <div class="add-button-container">
      <ion-button expand="block" class="add-vehicle-button mobile-add-button" (click)="onAddVehicle()">
        <ion-icon name="add" slot="start"></ion-icon>
        Agregar Vehículo
      </ion-button>
    </div>

    <!-- Loading Skeleton -->
    <div *ngIf="isLoading" class="loading-container">
      <ion-skeleton-text animated style="width: 100%; height: 120px; margin-bottom: 12px; border-radius: 12px;"></ion-skeleton-text>
      <ion-skeleton-text animated style="width: 100%; height: 120px; border-radius: 12px;"></ion-skeleton-text>
    </div>

    <!-- Error State -->
    <div *ngIf="!isLoading && error" class="error-container">
      <ion-icon name="alert-circle-outline" class="error-icon"></ion-icon>
      <h2>Error al cargar vehículos</h2>
      <p>{{ error }}</p>
      <ion-button class="retry-button" (click)="onRetry()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Reintentar
      </ion-button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && !error && vehicles.length === 0" class="empty-state">
      <ion-icon name="car-outline" class="empty-icon"></ion-icon>
      <h2>Aún no tienes vehículos</h2>
      <p>Comienza agregando tu primer vehículo</p>
      <ion-button class="empty-add-button" (click)="onAddVehicle()">
        <ion-icon name="add" slot="start"></ion-icon>
        Agregar Vehículo
      </ion-button>
    </div>

    <!-- Lista de Vehículos MÓVIL: Cards verticales -->
    <div *ngIf="!isLoading && !error && vehicles.length > 0" class="vehicles-list mobile-vehicles-list">
      <div *ngFor="let vehicle of vehicles; let last = last" class="vehicle-card mobile-vehicle-card">
        <div class="vehicle-card-content mobile-card-content">
          <!-- Imagen del vehículo -->
          <div class="vehicle-image-container mobile-image">
            <div class="vehicle-image-placeholder">
              <ion-icon name="car-sport-outline" class="vehicle-placeholder-icon"></ion-icon>
            </div>
          </div>

          <!-- Información del vehículo -->
          <div class="vehicle-info-container mobile-info">
            <div class="vehicle-info">
              <h2 class="vehicle-name">{{ vehicle.marca }} {{ vehicle.modelo }}</h2>
              <div class="vehicle-details">
                <span class="detail-item">Año: {{ vehicle.anio }}</span>
                <span class="detail-item">Matrícula: {{ vehicle.matricula }}</span>
                <span class="detail-item maintenance-item">
                  <ion-icon name="information-circle-outline" class="maintenance-icon"></ion-icon>
                  Sin datos de mantenimiento
                </span>
                <span class="detail-item km-item">
                  <ion-icon name="speedometer-outline" class="km-icon"></ion-icon>
                  Kilometraje: {{ formatKilometers(vehicle.kmActuales) }} km
                </span>
              </div>
            </div>

            <!-- Botones de acción -->
            <div class="vehicle-actions">
              <ion-button fill="outline" class="action-button details-button" (click)="onViewDetails(vehicle)">
                Ver Detalles
                <ion-icon name="chevron-down-outline" slot="end"></ion-icon>
              </ion-button>
              <!-- Ocultado para beta - próximamente -->
              <!--
              <ion-button fill="outline" class="action-button alerts-button" (click)="onViewAlerts(vehicle)">
                Alertas
                <ion-badge color="danger" class="alert-badge">0</ion-badge>
              </ion-button>
              -->
              <ion-button fill="clear" class="action-button delete-button icon-btn-danger" (click)="onDeleteVehicle(vehicle)" aria-label="Eliminar vehículo">
                <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>
        
        <!-- Separador entre cards -->
        <div *ngIf="!last" class="vehicle-separator mobile-separator"></div>
      </div>
    </div>
  </div>

  <!-- MODO DESKTOP: Contenedor dashboard -->
  <div class="desktop-wrapper">
    <div class="desktop-container">
      <!-- Título y Subtítulo Desktop -->
      <div class="page-header desktop-header">
        <h1 class="page-title">Mis Vehículos</h1>
        <p class="page-subtitle">Administra y monitorea tus autos</p>
      </div>

      <!-- Botón Agregar Vehículo (DESKTOP: alineado izquierda) -->
      <div class="add-button-container desktop-add-container">
        <ion-button class="add-vehicle-button desktop-add-button" (click)="onAddVehicle()">
          <ion-icon name="add" slot="start"></ion-icon>
          Agregar Vehículo
        </ion-button>
      </div>

      <!-- Loading Skeleton Desktop -->
      <div *ngIf="isLoading" class="loading-container desktop-loading">
        <ion-skeleton-text animated style="width: 100%; height: 200px; margin-bottom: 24px; border-radius: 16px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 100%; height: 200px; border-radius: 16px;"></ion-skeleton-text>
      </div>

      <!-- Error State Desktop -->
      <div *ngIf="!isLoading && error" class="error-container desktop-error">
        <ion-icon name="alert-circle-outline" class="error-icon"></ion-icon>
        <h2>Error al cargar vehículos</h2>
        <p>{{ error }}</p>
        <ion-button class="retry-button" (click)="onRetry()">
          <ion-icon name="refresh-outline" slot="start"></ion-icon>
          Reintentar
        </ion-button>
      </div>

      <!-- Empty State Desktop -->
      <div *ngIf="!isLoading && !error && vehicles.length === 0" class="empty-state desktop-empty">
        <ion-icon name="car-outline" class="empty-icon"></ion-icon>
        <h2>Aún no tienes vehículos</h2>
        <p>Comienza agregando tu primer vehículo</p>
        <ion-button class="empty-add-button" (click)="onAddVehicle()">
          <ion-icon name="add" slot="start"></ion-icon>
          Agregar Vehículo
        </ion-button>
      </div>

      <!-- Lista de Vehículos DESKTOP: Grid con cards horizontales -->
      <div *ngIf="!isLoading && !error && vehicles.length > 0" class="vehicles-list desktop-vehicles-list">
        <div *ngFor="let vehicle of vehicles" class="vehicle-card desktop-vehicle-card">
          <div class="vehicle-card-content desktop-card-content">
            <!-- Imagen del vehículo (izquierda) -->
            <div class="vehicle-image-container desktop-image">
              <div class="vehicle-image-placeholder">
                <ion-icon name="car-sport-outline" class="vehicle-placeholder-icon"></ion-icon>
              </div>
            </div>

            <!-- Información del vehículo (derecha) -->
            <div class="vehicle-info-container desktop-info">
              <div class="vehicle-info">
                <h2 class="vehicle-name">{{ vehicle.marca }} {{ vehicle.modelo }}</h2>
                <div class="vehicle-details">
                  <span class="detail-item">Año: {{ vehicle.anio }}</span>
                  <span class="detail-item">Matrícula: {{ vehicle.matricula }}</span>
                  <span class="detail-item maintenance-item">
                    <ion-icon name="information-circle-outline" class="maintenance-icon"></ion-icon>
                    Sin datos de mantenimiento
                  </span>
                  <span class="detail-item km-item">
                    <ion-icon name="speedometer-outline" class="km-icon"></ion-icon>
                    Kilometraje: {{ formatKilometers(vehicle.kmActuales) }} km
                  </span>
                </div>
              </div>

              <!-- Botones de acción -->
              <div class="vehicle-actions desktop-actions">
                <ion-button fill="outline" class="action-button details-button" (click)="onViewDetails(vehicle)">
                  Ver Detalles
                  <ion-icon name="chevron-down-outline" slot="end"></ion-icon>
                </ion-button>
                <!-- Ocultado para beta - próximamente -->
                <!--
                <ion-button fill="outline" class="action-button alerts-button" (click)="onViewAlerts(vehicle)">
                  Alertas
                  <ion-badge color="danger" class="alert-badge">0</ion-badge>
                </ion-button>
                -->
                <ion-button fill="clear" class="action-button delete-button icon-btn-danger" (click)="onDeleteVehicle(vehicle)" aria-label="Eliminar vehículo">
                  <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
                </ion-button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pull to refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="refreshVehicles($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
</ion-content>

<ion-content [fullscreen]="true" class="reset-password-content">
  <!-- Header con Logo -->
  <div class="reset-password-header">
    <div class="logo-container">
      <ion-icon name="car-sport-outline" class="logo-icon"></ion-icon>
      <h1 class="logo-text">AutoLytix</h1>
    </div>
  </div>

  <!-- Card de Reset -->
  <div class="reset-password-container">
    <ion-card class="reset-password-card">
      <ion-card-content>
        <!-- Estado: No Token -->
        <div *ngIf="state === 'no-token'" class="reset-state">
          <ion-icon name="close-circle" class="error-icon"></ion-icon>
          <h2 class="reset-title">Enlace Inválido</h2>
          <p class="reset-message">El enlace de recuperación no es válido o ha expirado.</p>
          <ion-button
            expand="block"
            class="reset-button"
            (click)="goToForgotPassword()">
            Solicitar nuevo enlace
          </ion-button>
          <ion-button
            expand="block"
            fill="outline"
            class="reset-button-secondary"
            (click)="goToLogin()">
            Volver a Iniciar Sesión
          </ion-button>
        </div>

        <!-- Estado: Error (token inválido después de intentar reset) -->
        <div *ngIf="state === 'error'" class="reset-state">
          <ion-icon name="close-circle" class="error-icon"></ion-icon>
          <h2 class="reset-title">Error</h2>
          <p class="reset-message">{{ errorMessage }}</p>
          <ion-button
            expand="block"
            class="reset-button"
            (click)="goToForgotPassword()">
            Solicitar nuevo enlace
          </ion-button>
          <ion-button
            expand="block"
            fill="outline"
            class="reset-button-secondary"
            (click)="goToLogin()">
            Volver a Iniciar Sesión
          </ion-button>
        </div>

        <!-- Estado: Form -->
        <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" *ngIf="state === 'form'">
          <h2 class="reset-title">Restablecer Contraseña</h2>
          <p class="reset-subtitle">Introduce tu nueva contraseña</p>

          <!-- Input Nueva Contraseña -->
          <div class="input-wrapper" [class.error]="newPasswordControl?.invalid && newPasswordControl?.touched">
            <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
            <ion-input
              [type]="passwordVisible ? 'text' : 'password'"
              placeholder="Nueva contraseña"
              formControlName="newPassword"
              class="custom-input">
            </ion-input>
            <ion-icon
              [name]="passwordVisible ? 'eye-outline' : 'eye-off-outline'"
              class="password-toggle-icon"
              (click)="togglePasswordVisibility()">
            </ion-icon>
          </div>
          <div class="error-message" *ngIf="newPasswordControl?.invalid && newPasswordControl?.touched">
            <ion-icon name="alert-circle-outline"></ion-icon>
            <span *ngIf="newPasswordControl?.hasError('required')">La contraseña es requerida</span>
            <span *ngIf="newPasswordControl?.hasError('minlength')">La contraseña debe tener al menos 8 caracteres</span>
          </div>

          <!-- Input Confirmar Contraseña -->
          <div class="input-wrapper" [class.error]="confirmPasswordControl?.invalid && confirmPasswordControl?.touched">
            <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
            <ion-input
              [type]="confirmPasswordVisible ? 'text' : 'password'"
              placeholder="Confirmar contraseña"
              formControlName="confirmPassword"
              class="custom-input">
            </ion-input>
            <ion-icon
              [name]="confirmPasswordVisible ? 'eye-outline' : 'eye-off-outline'"
              class="password-toggle-icon"
              (click)="toggleConfirmPasswordVisibility()">
            </ion-icon>
          </div>
          <div class="error-message" *ngIf="confirmPasswordControl?.invalid && confirmPasswordControl?.touched">
            <ion-icon name="alert-circle-outline"></ion-icon>
            <span *ngIf="confirmPasswordControl?.hasError('required')">Debes confirmar la contraseña</span>
            <span *ngIf="confirmPasswordControl?.hasError('passwordMismatch')">Las contraseñas no coinciden</span>
          </div>

          <!-- Botón Cambiar contraseña -->
          <ion-button
            expand="block"
            type="submit"
            class="reset-button"
            [disabled]="isLoading">
            <ion-spinner *ngIf="isLoading" name="crescent" class="spinner-inline"></ion-spinner>
            <span *ngIf="!isLoading">Cambiar contraseña</span>
          </ion-button>

          <!-- Botón Volver -->
          <div class="back-to-login">
            <ion-button
              fill="clear"
              (click)="goToLogin()"
              class="back-button">
              <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
              Volver a iniciar sesión
            </ion-button>
          </div>
        </form>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
